mutate(across(c(ssp2Sc), ~ replace_na(., -999)))
head(ssp.df2)
supportive.df2
summary(supportive.df2)
#### Spatial availability of Abstinence-based approach
abstinence <- read.csv("../indicators_raw/us-abstinence-services2.csv")
head(abstinence)
#### Spatial availability of Abstinence-based approach
abstinence <- read.csv("../indicators_raw/abstinence-tract-2020.csv")
head(abstinence)
abstinence.df <- select(abstinence,HEROP_ID,Minutes2)
head(abstinence.df)
abstinence.df1 <- abstinence.df %>%
rename(abst2 = Minutes2)
head(abstinence.df1)
dim(abstinence.df1) # 85187
## Flip directionality as higher value == higher vulnerability (lower English proficiency)
abstinence.df1$abst2Sc <- abstinence.df1$abst2 * (-1)
## Flip directionality as higher value == higher vulnerability (lower English proficiency)
abstinence.df1$abst2Sc <- abstinence.df1$abst2 * (-1)
head(abstinence.df1)
abstinence.df2 <- abstinence.df1 %>%
mutate(across(c(abst2Sc), ~ replace_na(., -999)))
head(abstinence.df2)
summary(abstinence.df2)
head(MOUDType_wOTP)
MOUDType_wOTP$MetType <- ifelse(MOUDType_wOTP$MetTmDr2 < 30, 1, 0)
MOUDType_wOTP$BupType <- ifelse(MOUDType_wOTP$BupCntDr2 < 30, 1, 0)
MOUDType_wOTP$NalType <- ifelse(MOUDType_wOTP$NaltTmDr2 < 30, 1, 0)
MOUDType_wOTP$MOUDType <- MOUDType_wOTP$MetType + MOUDType_wOTP$BupType + MOUDType_wOTP$NalType
summary(MOUDType_wOTP)
MOUDType_wOTP <- MOUDType_wOTP %>%
mutate(across(c(MOUDType), ~ replace_na(., 0)))
head(MOUDType_wOTP)
summary(MOUDType_wOTP)
histogram(MOUDType_wOTP$MOUDType)
hist(MOUDType_wOTP$MOUDType)
dim(MOUDType_wOTP)
MOUDType_wOTP$MetType <- ifelse(MOUDType_wOTP$MetTmDr < 30, 1, 0)
MOUDType_wOTP$BupType <- ifelse(MOUDType_wOTP$BupCntDr < 30, 1, 0)
MOUDType_wOTP$NalType <- ifelse(MOUDType_wOTP$NaltTmDr < 30, 1, 0)
MOUDType_wOTP$MOUDType <- MOUDType_wOTP$MetType + MOUDType_wOTP$BupType + MOUDType_wOTP$NalType
summary(MOUDType_wOTP)
MOUDType_wOTP <- MOUDType_wOTP %>%
mutate(across(c(MOUDType), ~ replace_na(., 0)))
head(MOUDType_wOTP)
summary(MOUDType_wOTP)
hist(MOUDType_wOTP$MOUDType)
MOUDType_wOTP$MetType <- ifelse(MOUDType_wOTP$MetTmDr2 < 30, 1, 0)
MOUDType_wOTP$BupType <- ifelse(MOUDType_wOTP$BupCntDr2 < 30, 1, 0)
MOUDType_wOTP$NalType <- ifelse(MOUDType_wOTP$NaltTmDr2 < 30, 1, 0)
MOUDType_wOTP$MOUDType <- MOUDType_wOTP$MetType + MOUDType_wOTP$BupType + MOUDType_wOTP$NalType
summary(MOUDType_wOTP)
MOUDType_wOTP <- MOUDType_wOTP %>%
mutate(across(c(MOUDType), ~ replace_na(., 0)))
head(MOUDType_wOTP)
summary(MOUDType_wOTP)
hist(MOUDType_wOTP$MOUDType)
dim(MOUDType_wOTP) #85187
MOUDType_wOTP$MOUDType <- MOUDType_wOTP$MetType + MOUDType_wOTP$BupType
summary(MOUDType_wOTP)
MOUDType_wOTP <- MOUDType_wOTP %>%
mutate(across(c(MOUDType), ~ replace_na(., 0)))
head(MOUDType_wOTP)
summary(MOUDType_wOTP)
hist(MOUDType_wOTP$MOUDType)
hist(MOUDType_wOTP$MetTmDr2)
MOUDType_wOTP$MetType <- ifelse(MOUDType_wOTP$MetTmDr2 < 20, 1, 0)
MOUDType_wOTP$BupType <- ifelse(MOUDType_wOTP$BupCntDr2 < 20, 1, 0)
MOUDType_wOTP$NalType <- ifelse(MOUDType_wOTP$NaltTmDr2 < 20, 1, 0)
MOUDType_wOTP$MOUDType <- MOUDType_wOTP$MetType + MOUDType_wOTP$BupType + MOUDType_wOTP$NalType
summary(MOUDType_wOTP)
MOUDType_wOTP <- MOUDType_wOTP %>%
mutate(across(c(MOUDType), ~ replace_na(., 0)))
head(MOUDType_wOTP)
summary(MOUDType_wOTP)
hist(MOUDType_wOTP$MOUDType)
dim(MOUDType_wOTP) #85187
loud.stage2.1 <- left_join(MOUDType_wOTP, abstinence.df2, by="HEROP_ID")
loud.stage2.2 <- left_join(loud.stage2.1, ssp.df2, by="HEROP_ID")
head(loud.stage1.2)
head(loud.stage2.2)
head(pastMethdn)
pastMethdn.loud <- select(pastMethdn,HEROP_ID,)
pastMethdn.loud <- select(pastMethdn,HEROP_ID,pastMethd10Sc)
pastMethdn.loud <- select(pastMethdn,HEROP_ID,pastMethd10,pastMethd10Sc)
## Rename variable
pastMethdn <- pastMethdn %>%
rename(pastMethd10 = minutes2010)
head(pastMethdn)
## Flip directionality as higher value == higher vulnerability (lower English proficiency)
pastMethdn$pastMethd10Sc <- pastMethdn$pastMethd10*(-1)
pastMetdn.loud <- select(pastMethdn,HEROP_ID,pastMethd10,pastMethd10Sc)
head(pastMetdn.loud)
dim(MOUDType_wOTP) #85187
head(MOUDType_wOTP)
MOUDType.loud <- (HEROP_ID,MOUDType)
MOUDType.loud <- (MOUDType_wOTP,HEROP_ID,MOUDType)
MOUDType.loud <- (MOUDType_wOTP,HEROP_ID,MOUDType)
MOUDType.loud <- (MOUDType_wOTP, HEROP_ID,MOUDType)
MOUDType.loud <- (MOUDType_wOTP, HEROP_ID, MOUDType)
MOUDType.loud <- (MOUDType_wOTP, HEROP_ID)
head(MOUDType_wOTP)
summary(MOUDType_wOTP)
hist(MOUDType_wOTP$MOUDType)
dim(MOUDType_wOTP) #85187
head(MOUDType_wOTP)
MOUDType.loud <- select(MOUDType_wOTP, HEROP_ID,MOUDType)
head(MOUDType.loud)
head(ssp.df1)
head(ssp.df2)
ssp.loud <- ssp.df2
summary(abstinence.df2)
head(abstinence.df2)
abs.loud <-
############
# Merge stage 2 measures
############
loud.stage2.1 <- left_join(MOUDType_wOTP, abstinence.df2, by="HEROP_ID")
abs.loud <- abstinence.df2
loud.stage2.1 <- left_join(MOUDType.loud, abs.loud, by="HEROP_ID")
loud.stage2.2 <- left_join(loud.stage2.1, ssp.loud, by="HEROP_ID")
loud.stage2.3 <- left_join(loud.stage2.2, pastMetdn.loud, by="HEROP_ID")
head(loud.stage2.3)
pastMethdn <- pastMethdn %>%
mutate(across(c(pastMethd10Sc), ~ replace_na(., -999)))
head(pastMethdn)
pastMetdn.loud <- select(pastMethdn,HEROP_ID,pastMethd10,pastMethd10Sc)
head(pastMetdn.loud)
loud.stage2.3 <- left_join(loud.stage2.2, pastMetdn.loud, by="HEROP_ID")
head(loud.stage2.3)
pastMetdn.loud <- select(pastMethdn,HEROP_ID,pastMethd10,pastMethd10Sc)
head(pastMetdn.loud)
loud.stage2.3 <- left_join(loud.stage2.2, pastMetdn.loud, by="HEROP_ID")
head(loud.stage2.3)
### Historic presence of methadone  ###
pastMethdn <- read.csv("../indicators_raw/historic-methadone-timeseries.csv")
head(pastMethdn)
str(pastMethdn)
## Generate HEROP ID from GEOID integer that lost a digit
pastMethdn$GEOIDchar <- as.character(pastMethdn$GEOID)
view(pastMethdn)
pastMethdn$GEOIDchar2 <- ifelse(nchar(pastMethdn$GEOIDchar) == 10, paste0("0", pastMethdn$GEOID), pastMethdn$GEOID)
view(pastMethdn)
pastMethdn$HEROP_ID <- paste0('140US',pastMethdn$GEOIDchar2)
head(pastMethdn)
## Rename variable
pastMethdn <- pastMethdn %>%
rename(pastMethd10 = minutes2010)
head(pastMethdn)
## Flip directionality as higher value == higher vulnerability (lower English proficiency)
pastMethdn$pastMethd10Sc <- pastMethdn$pastMethd10*(-1)
pastMethdn <- pastMethdn %>%
mutate(across(c(pastMethd10Sc), ~ replace_na(., -999)))
head(pastMethdn)
View(pastMethdn)
pastMethdn <- pastMethdn %>%
mutate(across(c(pastMethd10Sc == -1216.24), ~ replace_na(., -999)))
pastMetdn.loud <- select(pastMethdn,HEROP_ID,pastMethd10,pastMethd10Sc)
head(pastMetdn.loud)
loud.stage2.1 <- left_join(MOUDType.loud, abs.loud, by="HEROP_ID")
loud.stage2.2 <- left_join(loud.stage2.1, ssp.loud, by="HEROP_ID")
loud.stage2.3 <- left_join(loud.stage2.2, pastMetdn.loud, by="HEROP_ID")
head(loud.stage2.3)
loud.stage2.3 <- left_join(loud.stage2.2, pastMetdn.loud, by="HEROP_ID")
head(loud.stage2.3)
head(pastMethdn)
pastMetdn.loud <- select(pastMethdn.2,HEROP_ID,pastMethd10,pastMethd10Sc)
head(pastMetdn.loud)
pastMetdn.loud <- select(pastMethdn.2,HEROP_ID,pastMethd10,pastMethd10Sc)
pastMethdn.2 <- pastMethdn %>%
mutate(across(c(pastMethd10Sc), ~ replace_na(., -999)))
head(pastMethdn.2)
pastMetdn.loud <- select(pastMethdn.2,HEROP_ID,pastMethd10,pastMethd10Sc)
head(pastMetdn.loud)
loud.stage2.3 <- left_join(loud.stage2.2, pastMetdn.loud, by="HEROP_ID")
head(loud.stage2.3)
summary(pastMetdn.loud)
loud.stage2.1 <- left_join(MOUDType.loud, abs.loud, by="HEROP_ID")
loud.stage2.2 <- left_join(loud.stage2.1, ssp.loud, by="HEROP_ID")
loud.stage2.3 <- left_join(loud.stage2.2, pastMetdn.loud, by="HEROP_ID")
head(loud.stage2.3)
## Limit to US-continent only
loud.stage2.3.us <- merge(tract.sf,loud.stage2.3, by="HEROP_ID")
head(loud.stage2.3.us) #82628
summary(loud.stage2.3.us)
loud.stage2 <- loud.stage2.3.us
head(loud.stage2.3.us) #82628
### Stage 1 Prep
loud.stage2.3.us$pastMethd10ScPPL <- percent_rank(loud.stage2$pastMethd10Sc)
loud.stage1$ssp2ScPPL <- percent_rank(loud.stage2$ssp2Sc)
loud.stage2.3.us$abst2ScPPL <- percent_rank(loud.stage2$abst2Sc)
### Stage 1 Prep
loud.stage2$pastMethd10ScPPL <- percent_rank(loud.stage2$pastMethd10Sc)
loud.stage2$ssp2ScPPL <- percent_rank(loud.stage2$ssp2Sc)
loud.stage2$abst2ScPPL <- percent_rank(loud.stage2$abst2Sc)
loud.stage2$MOUDTypePPL <- percent_rank(loud.stage2$MOUDType)
head(loud.stage2)
# Equally Weighted
loud.stage2$Stage2 <- (loud.stage2$pastMethd10ScPPL+ loud.stage2$ssp2ScPPL+
loud.stage2$abst2ScPPL + loud.stage2$MOUDTypePPL )/4
hist(loud.stage2$Stage2)
head(loud.stage2)
st_write(loud.stage2, "../data_final/loud.stage2.geojson")
#save(loud.stage5.df2,  file = "../data_final/loud_stage4-5.RData")
loud.stage2 <- st_drop_geometry(loud.stage2)
#save(loud.stage5.df2,  file = "../data_final/loud_stage4-5.RData")
loud.stage2.df <- st_drop_geometry(loud.stage2)
write.csv(loud.stage2.df, "../data_final/loud_stage2.csv", row.names = FALSE)
############
#### Spatial availability of Abstinence-based approach
abstinence <- read.csv("../indicators_raw/abstinence-tract-2020.csv")
head(abstinence)
abstinence.df <- select(abstinence,HEROP_ID,Minutes2)
head(abstinence.df)
abstinence.df1 <- abstinence.df %>%
rename(abst2 = Minutes2)
head(abstinence.df1)
dim(abstinence.df1) # 85187
abstinence.df2 <- abstinence.df1 %>%
mutate(across(c(abst2Sc), ~ replace_na(., -999)))
head(abstinence.df2)
############
#### Spatial availability of Abstinence-based approach
abstinence <- read.csv("../indicators_raw/abstinence-tract-2020.csv")
head(abstinence)
abstinence.df <- select(abstinence,HEROP_ID,Minutes2)
head(abstinence.df)
abstinence.df1 <- abstinence.df %>%
rename(abst2 = Minutes2)
head(abstinence.df1)
dim(abstinence.df1) # 85187
abstinence.df2 <- abstinence.df1 %>%
mutate(across(c(abst2Sc), ~ replace_na(., -999)))
abstinence.df2 <- abstinence.df1 %>%
mutate(across(c(abst2), ~ replace_na(., -999)))
abstinence.df2 <- abstinence.df1 %>%
mutate(across(c(abst2), ~ replace_na(., -999)))
head(abstinence.df2)
summary(abstinence.df2)
abs.loud <- abstinence.df2
### Stage 1 Prep
loud.stage2$pastMethd10ScPPL <- percent_rank(loud.stage2$pastMethd10Sc)
loud.stage2$ssp2ScPPL <- percent_rank(loud.stage2$ssp2Sc)
loud.stage2$abst2ScPPL <- percent_rank(loud.stage2$abst2Sc)
loud.stage2$MOUDTypePPL <- percent_rank(loud.stage2$MOUDType)
head(loud.stage2)
# Equally Weighted
loud.stage2$Stage2 <- (loud.stage2$pastMethd10ScPPL+ loud.stage2$ssp2ScPPL+
loud.stage2$abst2ScPPL + loud.stage2$MOUDTypePPL )/4
hist(loud.stage2$Stage2)
head(loud.stage2)
st_write(loud.stage2, "../data_final/loud.stage2.geojson")
#save(loud.stage5.df2,  file = "../data_final/loud_stage4-5.RData")
loud.stage2.df <- st_drop_geometry(loud.stage2)
write.csv(loud.stage2.df, "../data_final/loud_stage2.csv", row.names = FALSE)
hist(loud.stage2$Stage2)
summary(loud.stage2$Stage2)
S2Var <- c(loud.stage2$pastMethd10ScPPL, loud.stage2$ssp2ScPPL, loud.stage2$abst2ScPPL, loud.stage2$MOUDTypePPL)
loud.stage2$Stage2v2 <- mean(S2Var, na.rm = TRUE)
head(loud.stage2)
summary(loud.stage2$Stage2v2)
loud.stage2$Stage2v2 <- sum(S2Var, na.rm = TRUE) / 4
summary(loud.stage2$Stage2v2)
head(loud.stage2)
head(loud.stage2.3)
loud.stage2.3 <- loud.stage2.3 %>%
mutate(across(c(pastMethd10Sc), ~ replace_na(., -999)))
head(loud.stage2.3)
## Limit to US-continent only
loud.stage2.3.us <- merge(tract.sf,loud.stage2.3, by="HEROP_ID")
head(loud.stage2.3.us) #82628
summary(loud.stage2.3.us)
loud.stage2 <- loud.stage2.3.us
### Stage 1 Prep
loud.stage2$pastMethd10ScPPL <- percent_rank(loud.stage2$pastMethd10Sc)
loud.stage2$ssp2ScPPL <- percent_rank(loud.stage2$ssp2Sc)
loud.stage2$abst2ScPPL <- percent_rank(loud.stage2$abst2Sc)
loud.stage2$MOUDTypePPL <- percent_rank(loud.stage2$MOUDType)
head(loud.stage2)
loud.stage2$Stage2 <- (loud.stage2$pastMethd10ScPPL+ loud.stage2$ssp2ScPPL+
loud.stage2$abst2ScPPL + loud.stage2$MOUDTypePPL)/4
hist(loud.stage2$Stage2)
head(loud.stage2)
summary(loud.stage2$Stage2)
head(loud.stage2)
st_write(loud.stage2, "../data_final/loud.stage2.geojson")
#save(loud.stage5.df2,  file = "../data_final/loud_stage4-5.RData")
loud.stage2.df <- st_drop_geometry(loud.stage2)
write.csv(loud.stage2.df, "../data_final/loud_stage2.csv", row.names = FALSE)
############
#### Spatial availability of Abstinence-based approach
abstinence <- read.csv("../indicators_raw/abstinence-tract-2020.csv")
head(abstinence)
abstinence.df <- select(abstinence,HEROP_ID,Minutes2)
head(abstinence.df)
abstinence.df1 <- abstinence.df %>%
rename(abst2 = Minutes2)
head(abstinence.df1)
dim(abstinence.df1) # 85187
abstinence.df2 <- abstinence.df1 %>%
mutate(across(c(abst2), ~ replace_na(., -999)))
head(abstinence.df2)
summary(abstinence.df2)
abs.loud <- abstinence.df2
head(loud.stage2.3.us) #82628
summary(loud.stage2.3.us)
loud.stage2 <- loud.stage2.3.us
### Stage 1 Prep
loud.stage2$pastMethd10ScPPL <- percent_rank(loud.stage2$pastMethd10Sc)
loud.stage2$ssp2ScPPL <- percent_rank(loud.stage2$ssp2Sc)
loud.stage2$abstPPL <- percent_rank(loud.stage2$abst2)
loud.stage2$MOUDTypePPL <- percent_rank(loud.stage2$MOUDType)
head(loud.stage2)
loud.stage2$Stage2 <- (loud.stage2$pastMethd10ScPPL+ loud.stage2$ssp2ScPPL+
loud.stage2$abst2PPL + loud.stage2$MOUDTypePPL)/4
hist(loud.stage2$Stage2)
loud.stage2$Stage2 <- (loud.stage2$pastMethd10ScPPL+ loud.stage2$ssp2ScPPL+
loud.stage2$abstPPL + loud.stage2$MOUDTypePPL)/4
hist(loud.stage2$Stage2)
head(loud.stage2)
summary(loud.stage2$Stage2)
head(loud.stage2)
st_write(loud.stage2, "../data_final/loud.stage2.geojson")
#save(loud.stage5.df2,  file = "../data_final/loud_stage4-5.RData")
loud.stage2.df <- st_drop_geometry(loud.stage2)
write.csv(loud.stage2.df, "../data_final/loud_stage2.csv", row.names = FALSE)
tract.sf <- st_read("../indicators_raw/tract-continental.geojson")
head(tract.sf)
stage1 <- st_read("../indicators_raw/loud_stage1.geojson")
stage1 <- st_read("../data_final/loud_stage1.geojson")
stage2 <- st_read("../data_final/loud_stage2.geojson")
stage3 <- st_read("../data_final/loud_stage3.geojson")
stage1 <- st_read("../data_final/loud.stage1.geojson")
stage2 <- st_read("../data_final/loud.stage2.geojson")
stage3 <- st_read("../data_final/loud.stage3.geojson")
stage4 <- st_read("../data_final/loud.stage4.geojson")
stage5 <- st_read("../data_final/loud.stage5.geojson")
## Limit to US-continent only, master version
loud1 <- left_join(tract.sf,stage1, by="HEROP_ID")
stage1.df <- st_drop_geometry(stage1)
stage2.df <- st_drop_geometry(stage2)
stage3.df <- st_drop_geometry(stage3)
stage4.df <- st_drop_geometry(stage4)
stage5.df <- st_drop_geometry(stage5)
## Limit to US-continent only, master version
loud1 <- left_join(tract.sf,stage1.df, by="HEROP_ID")
loud2 <- left_join(loud1,stage2.df, by="HEROP_ID")
loud3 <- left_join(loud2,stage3.df, by="HEROP_ID")
loud4 <- left_join(loud3,stage4.df, by="HEROP_ID")
loud5 <- left_join(loud4,stage5.df, by="HEROP_ID")
head(loud5) #82628
glimps(loud5) #83507
glimpse(loud5) #83507
loud5$AccessScore <- loud5$Stage1 + loud5$Stage2 + loud5$Stage3 + loud5$Stage4 + loud5$Stage5
library(scales)
loud5$AccessScoreSc <- rescale(loud5$AccessScore, to = c(0, 100))
head(tract.sf)
loud <- left_join(tract.sf,loud5,by="HEROP_ID")
loud <- merge(tract.sf,loud5,by="HEROP_ID")
st_write(loud5, "../data_final/loud-access-score.geojson")
#save(loud.stage5.df2,  file = "../data_final/loud_stage4-5.RData")
loud <- st_drop_geometry(loud5)
write.csv(loud, "../data_final/loud_access_score.csv", row.names = FALSE)
library(sf)
loud <- st_read("../data_final/loud-access-score.geojson")
setwd("~/Code/loud-study/scripts")
library(sf)
loud <- st_read("../data_final/loud-access-score.geojson")
xwalk <- read.csv("../indicators-raw/TRACT_ZIP_122023.csv")
xwalk <- read.csv("../indicators_raw/TRACT_ZIP_122023.csv")
head(xwalk)
str(xwalk)
## Generate HEROP ID from GEOID integer that lost a digit
xwalk$GEOIDchar <- as.character(xwalk$GEOID)
head(xwalk)
## Generate HEROP ID from GEOID integer that lost a digit
xwalk$GEOIDchar <- as.character(xwalk$TRACT)
view(xwalk)
xwalk$GEOIDchar2 <- ifelse(nchar(xwalk$GEOIDchar) == 10, paste0("0", xwalk$TRACT), xwalk$TRACT)
view(xwalk)
xwalk$HEROP_ID <- paste0('140US',xwalk$GEOIDchar2)
head(xwalk)
loud.zip1 <- merge(loud,xwalk, by="HEROP_ID")
head(loud.zip1)
loud.zip2 <- select(loud.zip1,ZIP,HEROP_ID,AccessScoreSc,
Stage1,Stage1Cat,Stage2,Stage2Cat,Stage3,Stage3Cat,
Stage4,Stage4Cat,Stage5,Stage5Cat)
head(loud.zip2)
loud.zip2 <- select(loud.zip1,ZIP,TOT_RATIO,HEROP_ID,AccessScoreSc,
Stage1,Stage1Cat,Stage2,Stage2Cat,Stage3,Stage3Cat,
Stage4,Stage4Cat,Stage5,Stage5Cat)
head(loud.zip2)
loud.zip2 <- select(loud.zip1,ZIP,GEOIDchar2,TOT_RATIO,HEROP_ID,AccessScoreSc,
Stage1,Stage1Cat,Stage2,Stage2Cat,Stage3,Stage3Cat,
Stage4,Stage4Cat,Stage5,Stage5Cat)
loud.zip2 <- select(loud.zip1,ZIP,TRACT,TOT_RATIO,HEROP_ID,AccessScoreSc,
Stage1,Stage1Cat,Stage2,Stage2Cat,Stage3,Stage3Cat,
Stage4,Stage4Cat,Stage5,Stage5Cat)
head(loud.zip2)
loud.zip2$AccessScoreScZip <- loud.zip2$AccessScoreSc * loud.zip2$TOT_RATIO
head(loud.zip2)
loud.zip2$Stage1Zip <- loud.zip2$Stage1 * loud.zip2$TOT_RATIO
loud.zip2$Stage1CatZip <- loud.zip2$Stage1Cat * loud.zip2$TOT_RATIO
loud.zip2$Stage2Zip <- loud.zip2$Stage2 * loud.zip2$TOT_RATIO
loud.zip2$Stage2CatZip <- loud.zip2$Stage2Cat * loud.zip2$TOT_RATIO
loud.zip2$Stage3Zip <- loud.zip2$Stage3 * loud.zip2$TOT_RATIO
loud.zip2$Stage3CatZip <- loud.zip2$Stage3Cat * loud.zip2$TOT_RATIO
loud.zip2$Stage4Zip <- loud.zip2$Stage4 * loud.zip2$TOT_RATIO
loud.zip2$Stage5Zip <- loud.zip2$Stage5 * loud.zip2$TOT_RATIO
loud.zip2$Stage5CatZip <- loud.zip2$Stage5Cat * loud.zip2$TOT_RATIO
head(loud.zip2)
loud.zip2$Stage4CatZip <- loud.zip2$Stage4Cat * loud.zip2$TOT_RATIO
loud.zip3 <- loud.zip2 %>%
group_by(ZIP) %>%
summarize(
AccessScoreScZip = sum(AccessScoreScZip, na.rm = TRUE),
Stage1Zip = sum(Stage1Zip, na.rm = TRUE),
Stage1CatZip = sum(Stage1CatZip, na.rm = TRUE),
Stage2Zip = sum(Stage2Zip, na.rm = TRUE),
Stage2CatZip = sum(Stage2CatZip, na.rm = TRUE),
Stage3Zip = sum(Stage3Zip, na.rm = TRUE),
Stage3CatZip = sum(Stage3CatZip, na.rm = TRUE),
Stage4Zip = sum(Stage4Zip, na.rm = TRUE),
Stage4CatZip = sum(Stage4CatZip, na.rm = TRUE),
Stage5Zip = sum(Stage5, na.rm = TRUE),
Stage5CatZip = sum(Stage5CatZip, na.rm = TRUE))
loud.zip3 <- loud.zip2 %>%
group_by(ZIP) %>%
summarize(
AccessScoreScZip = sum(AccessScoreScZip, na.rm = TRUE),
Stage1Zip = sum(Stage1Zip, na.rm = TRUE),
Stage1CatZip = sum(Stage1CatZip, na.rm = TRUE),
Stage2Zip = sum(Stage2Zip, na.rm = TRUE),
Stage2CatZip = sum(Stage2CatZip, na.rm = TRUE),
Stage3Zip = sum(Stage3Zip, na.rm = TRUE),
Stage3CatZip = sum(Stage3CatZip, na.rm = TRUE),
Stage4Zip = sum(Stage4Zip, na.rm = TRUE),
Stage4CatZip = sum(Stage4CatZip, na.rm = TRUE),
Stage5Zip = sum(Stage5, na.rm = TRUE),
Stage5CatZip = sum(Stage5CatZip, na.rm = TRUE))
head(loud.zip3)
loud.zip.df <- st_drop_geometry(loud.zip3)
loud.zip3 <- loud.zip2 %>%
group_by(ZIP) %>%
summarize(
AccessScoreScZip = sum(AccessScoreScZip, na.rm = TRUE),
Stage1Zip = sum(Stage1Zip, na.rm = TRUE),
Stage2Zip = sum(Stage2Zip, na.rm = TRUE),
Stage3Zip = sum(Stage3Zip, na.rm = TRUE),
Stage4Zip = sum(Stage4Zip, na.rm = TRUE),
Stage5Zip = sum(Stage5, na.rm = TRUE))
loud.tractwzip.df <- st_drop_geometry(loud.zip2)
View(loud.zip2)
head(loud.zip3)
loud.zip3 <- loud.zip2 %>%
group_by(ZIP) %>%
summarize(
AccessScoreScZip = mean(AccessScoreScZip, na.rm = TRUE),
Stage1Zip = mean(Stage1Zip, na.rm = TRUE),
Stage2Zip = mean(Stage2Zip, na.rm = TRUE),
Stage3Zip = mean(Stage3Zip, na.rm = TRUE),
Stage4Zip = mean(Stage4Zip, na.rm = TRUE),
Stage5Zip = mean(Stage5, na.rm = TRUE))
write.csv(loud.tractwzip.df, "../data_final/loud.tractwzip.df.csv", row.names = FALSE)
loud.zip3 <- loud.zip2 %>%
group_by(ZIP) %>%
summarize(
AccessScoreScZip = mean(AccessScoreScZip, na.rm = TRUE),
Stage1Zip = mean(Stage1Zip, na.rm = TRUE),
Stage2Zip = mean(Stage2Zip, na.rm = TRUE),
Stage3Zip = mean(Stage3Zip, na.rm = TRUE),
Stage4Zip = mean(Stage4Zip, na.rm = TRUE),
Stage5Zip = mean(Stage5Zip, na.rm = TRUE))
head(loud.zip3)
loud.zip3 <- loud.zip2 %>%
group_by(ZIP) %>%
summarize(
AccessScoreScZip = mean(AccessScoreScZip, na.rm = TRUE),
Stage1Zip = mean(Stage1Zip, na.rm = TRUE),
Stage1CatZip = mean(Stage1CatZip, na.rm = TRUE),
Stage2Zip = mean(Stage2Zip, na.rm = TRUE),
Stage2CatZip = mean(Stage2CatZip, na.rm = TRUE),
Stage3Zip = mean(Stage3Zip, na.rm = TRUE),
Stage3CatZip = mean(Stage3CatZip, na.rm = TRUE),
Stage4Zip = mean(Stage4Zip, na.rm = TRUE),
Stage4CatZip = mean(Stage4CatZip, na.rm = TRUE),
Stage5Zip = mean(Stage5Zip, na.rm = TRUE),
Stage5CatZip = mean(Stage5CatZip, na.rm = TRUE))
head(loud.zip3)
loud.zip.df <- st_drop_geometry(loud.zip3)
write.csv(loud.zip.df, "../data_final/loud.zip.csv", row.names = FALSE)
st_write(loud.zip3, "../data_final/loud.zip.geojson")
## Generate HEROP ID from ZIP integer that lost digits
loud.zip3$ZIPchar <- as.character(loud.zip3$ZIP)
view(loud.zip3)
pastMethdn$GEOIDchar2 <- ifelse(loud.zip3$ZIPchar) == 3, paste0("00", loud.zip3$ZIP),
pastMethdn$GEOIDchar2 <- ifelse(loud.zip3$ZIPchar == 3, paste0("00", loud.zip3$ZIP),
ifelse(loud.zip3$ZIPchar) == 4, paste0("0", loud.zip3$ZIP), loud.zip3$ZIP)
ifelse(nchar(loud.zip3$ZIPchar) == 4, paste0("0", loud.zip3$ZIP),
loud.zip3$GEOIDchar2 <- ifelse(nchar(loud.zip3$ZIPchar) == 3, paste0("00", loud.zip3$ZIP),
ifelse(nchar(loud.zip3$ZIPchar) == 4, paste0("0", loud.zip3$ZIP),
loud.zip3$ZIP))
view(loud.zip3)
loud.zip3$GEOIDchar2 <-ifelse(nchar(loud.zip3$ZIPchar) == 3, paste0("00", loud.zip3$ZIP),
ifelse(nchar(loud.zip3$ZIPchar) == 4, paste0("0", loud.zip3$ZIP),
loud.zip3$ZIP))
view(loud.zip3)
st_write(loud.zip3, "../data_final/loud.zip.geojson")
loud.zip.df <- st_drop_geometry(loud.zip3)
write.csv(loud.zip.df, "../data_final/loud.zip.csv", row.names = FALSE)
view(loud.zip3)
